---
title: "Simulating from an improper Jeffreys Prior"
output:
  html_notebook: default
  workflowr::wflow_html:
    toc: false
    code_folding: show
editor_options: 
  chunk_output_type: inline
---



## Introduction


If we model the posterior distribution of the "true" log Odds ratio $\theta$ givent the observed log OR $\hat{\theta}$, 

such that 

$$p(\theta) \propto 1$$ 

$$p(\hat{\theta}|\theta) \sim N(\theta,\hat{se})$$

$$p(\theta|\hat{\theta}) \sim N(\hat{\theta},\hat{se})$$



```{r}

polyCurve <- function(x, y, from, to, n = 50, miny,
                      col = "red", border = col) {
    drawPoly <- function(fun, from, to, n = 50, miny, col, border) {
        Sq <- seq(from = from, to = to, length = n)
        polygon(x = c(Sq[1], Sq, Sq[n]),
                y = c(miny, fun(Sq), miny),
                col = col, border = border)
    }
    lf <- length(from)
    stopifnot(identical(lf, length(to)))
    if(length(col) != lf)
        col <- rep(col, length.out = lf)
    if(length(border) != lf)
        border <- rep(border, length.out = lf)
    if(missing(miny))
        miny <- min(y)
    interp <- approxfun(x = x, y = y)
    mapply(drawPoly, from = from, to = to, col = col, border = border,
           MoreArgs = list(fun = interp, n = n, miny = miny))
    invisible()
}
```

```{r,echo=FALSE}

th = seq(-1,1,length=500)

hatlogOR=log((172/172)/(194/147))
hatdataSE=sqrt(1/172+1/(344-172) + 1/194 + 1/(341-194))
prior = rep(1,length(th))
like = dnorm(hatlogOR,mean=th,sd=hatdataSE)
post = dnorm(th,hatlogOR,hatdataSE)

plot(th,post,type="l",ylab="Density",lty=2,lwd=3,xlab = expression(theta), panel.first = polyCurve(th, like, from = 0, to = 2))
lines(th,like,lty=3,lwd=5,col="red")
lines(th,prior,lty=2,lwd=3,col="blue")
legend(0.4,1.5,c("Prior","Likelihood","Posterior"),lty=c(2,3,1),lwd=c(3,3,3),col=c("Blue","red","black"))
```


```

And we can see that the probability $\theta \leq  0$ is 0.965:

```{r}
pnorm(0,mean = hatlogOR,sd = hatdataSE)
```


First, let's recreate their beta-binomial result for Single Vessel and Multivessle

```{r}
p=seq(0,1,by=0.001)
prior=dbeta(p,0.01,0.01)
like=dbinom(x=172,size=344,prob=p)
post=dbeta(p,0.01+172,0.01+344-172)



p=seq(0,1,by=0.001)
prior=dbeta(p,0.01,0.01)
multilike=dbinom(x=194,size=341,prob=p)
multipost=dbeta(p,0.01+194,0.01+341-194)


par(mfrow=c(1,3))
plot(p,prior,type="l",ylab="Density",lty=1,lwd=3,xlab = expression(theta),main="Prior")


plot(p,multilike,type="l",col="blue",xlab=expression(theta),main="Likelihood")

lines(p,like,col="red")

legend(0.7,0.02,c("Single","Multi"),lty=c(1,1),col=c("red","blue"))


plot(p,multipost,type="l",col="blue",xlab=expression(theta),main="Posterior")
lines(p,post,type="l",col="red")
legend(0.7,5,c("Single","Multi"),lty=c(1,1),col=c("red","blue"))

```







